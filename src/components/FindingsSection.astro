---
const rawBase = import.meta.env.BASE_URL ?? '/';
const normalizedBase = rawBase.endsWith('/') ? rawBase : `${rawBase}/`;
const assetPath = (path: string) => `${normalizedBase}${path.replace(/^\//, '')}`;
---

<!-- Detailed Analysis (Expandable Cards) -->
<section id="detailed-analysis" class="content-section">
  <div class="section-container">
    <h2 class="section-title">Key Findings</h2>
    <div class="findings-grid-cards">
      <!-- Finding 1 -->
      <details class="finding-card finding-1" open>
        <summary class="finding-header">
          <div class="finding-number">01</div>
          <div class="finding-content">
            <h3 class="finding-title">Active Exploration Bottleneck</h3>
            <p class="finding-summary">Active exploration is the bottleneck.</p>
          </div>
          <span class="finding-toggle" aria-hidden="true"></span>
        </summary>
        <div class="finding-details">
          <p class="finding-text">
            Active exploration is a key bottleneck: performance drops when models must choose actions under partial observability, compared to passive comprehension from standardized logs.
          </p>
          <div class="finding-media-grid">
            <div class="finding-media-left-col">
              <img
                src={assetPath('passive-active-gap-text.png')}
                alt="Passive vs active gap in text world"
                class="finding-media media-lg"
                loading="lazy"
              />
              <img
                src={assetPath('passive-active-gap-vision.png')}
                alt="Passive vs active gap in vision world"
                class="finding-media media-lg"
                loading="lazy"
              />
            </div>
            <div class="finding-media-right-col">
              <img
                src={assetPath('infogain.png')}
                alt="Information gain analysis"
                class="finding-media"
                loading="lazy"
              />
            </div>
          </div>
        </div>
      </details>

      <!-- Finding 2 -->
      <details class="finding-card finding-2" open>
        <summary class="finding-header">
          <div class="finding-number">02</div>
          <div class="finding-content">
            <h3 class="finding-title">Modality Gap</h3>
            <p class="finding-summary">Text stays ahead of vision.</p>
          </div>
          <span class="finding-toggle" aria-hidden="true"></span>
        </summary>
        <div class="finding-details">
          <p class="finding-text">
            A clear modality gap persists: text-based settings consistently outperform vision-based settings in spatial belief construction and exploitation.
          </p>
          <div class="finding-media-grid finding-media-grid-2">
            <img
              src={assetPath('vision-text-gap-passive.png')}
              alt="Vision vs text gap under passive setting"
              class="finding-media"
              loading="lazy"
            />
            <img
              src={assetPath('vision-text-gap-active.png')}
              alt="Vision vs text gap under active setting"
              class="finding-media"
              loading="lazy"
            />
          </div>
        </div>
      </details>

      <!-- Finding 3 -->
      <details class="finding-card finding-3" open>
        <summary class="finding-header">
          <div class="finding-number">03</div>
          <div class="finding-content">
            <h3 class="finding-title">Active-Passive Gap Increases with Complexity</h3>
            <p class="finding-summary">Gemini-3 Pro scales much better.</p>
          </div>
          <span class="finding-toggle" aria-hidden="true"></span>
        </summary>
        <div class="finding-details">
          <p class="finding-text">
            The active–passive gap increases with complexity; Gemini-3 Pro scales much better. As the number of rooms increases, exploration cost rises accordingly. For both GPT-5.2 and Gemini-3 Pro, performance declines as the room number increases, and the active–passive performance gap widens with room number.
          </p>
          
          <div class="finding-table-wrapper">
            <table class="finding-table">
              <thead>
                <tr class="table-header-main">
                  <th rowspan="2" class="col-method">Methods</th>
                  <th colspan="3" class="header-sep">2-room</th>
                  <th colspan="3" class="header-sep">4-room</th>
                </tr>
                <tr class="table-header-main">
                  <th class="col-sub">pass.</th><th class="col-sub">act.</th><th class="col-sub">exp.</th>
                  <th class="col-sub">pass.</th><th class="col-sub">act.</th><th class="col-sub">exp.</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="7" class="col-group">Text-based World</td></tr>
                <tr>
                  <td class="row-label">GPT-5.2</td>
                  <td class="best-score">92.3</td><td>77.8</td><td>6.2</td>
                  <td class="best-score">86.5</td><td>66.0</td><td>16.4</td>
                </tr>
                <tr>
                  <td class="row-label">Gemini-3 Pro</td>
                  <td>86.7</td><td class="best-score">80.6</td><td>6.2</td>
                  <td>81.2</td><td class="best-score">77.7</td><td>19.7</td>
                </tr>
                <tr><td colspan="7" class="col-group">Vision-based World</td></tr>
                <tr>
                  <td class="row-label">GPT-5.2</td>
                  <td class="best-score">59.3</td><td>51.5</td><td>10.8</td>
                  <td>52.6</td><td>40.3</td><td>23.2</td>
                </tr>
                <tr>
                  <td class="row-label">Gemini-3 Pro</td>
                  <td>58.3</td><td class="best-score">57.8</td><td>6.6</td>
                  <td class="best-score">56.2</td><td class="best-score">51.5</td><td>19.7</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </details>

      <!-- Finding 4 -->
      <details class="finding-card finding-4" open>
        <summary class="finding-header">
          <div class="finding-number">04</div>
          <div class="finding-content">
            <h3 class="finding-title">Bottleneck: Perception & Stability</h3>
            <p class="finding-summary">Perception noise and unstable belief.</p>
          </div>
          <span class="finding-toggle" aria-hidden="true"></span>
        </summary>
        <div class="finding-details">
          <p class="finding-text">
            Vision perception remains a key bottleneck, especially for object orientation. Unstable cognitive map prediction degrades spatial belief beyond initial perception.
          </p>
        </div>
      </details>
    </div>
  </div>
</section>

<style>
  /* Detailed Analysis (Cards) Styles */
  #detailed-analysis .section-container {
    max-width: var(--page-max-width, 1500px);
  }

  .analysis-heading {
    font-size: 1.3rem;
    font-weight: 700;
    color: #2a2f6c;
    margin: 0 0 1.25rem 0;
    text-align: center;
  }

  .findings-grid-cards {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    margin-top: 3rem;
  }

  .finding-card {
    position: relative;
    background: #ffffff;
    border-radius: 20px;
    padding: 2.5rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    border: 1px solid rgba(0, 0, 0, 0.05);
    display: block;
  }

  .finding-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, transparent, currentColor, transparent);
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .finding-card::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: currentColor;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .finding-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
  }

  .finding-card:hover::before {
    opacity: 1;
  }

  .finding-card:hover::after {
    transform: scaleX(1);
  }

  .finding-card summary {
    list-style: none;
  }

  .finding-card summary::-webkit-details-marker {
    display: none;
  }

  .finding-header {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 2rem;
    cursor: pointer;
  }

  .finding-number {
    font-size: 3.5rem;
    font-weight: 800;
    line-height: 1;
    color: currentColor;
    font-family: 'Inter', sans-serif;
    flex-shrink: 0;
    opacity: 0.9;
    min-width: 80px;
  }

  .finding-content {
    flex: 1;
  }

  .finding-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: #2a2f6c;
    line-height: 1.3;
  }

  .finding-summary {
    font-size: 1.05rem;
    color: #2e2e2e;
    margin: 0;
    font-weight: 600;
  }

  .finding-text {
    font-size: 1rem;
    line-height: 1.7;
    color: #555;
    margin: 0;
  }

  .finding-toggle {
    width: 32px;
    height: 32px;
    border-radius: 999px;
    border: 1px solid currentColor;
    display: grid;
    place-items: center;
    font-size: 1.4rem;
    line-height: 1;
    color: currentColor;
    transition: transform 0.3s ease, background 0.3s ease;
    flex-shrink: 0;
  }

  .finding-toggle::before {
    content: '+';
  }

  details[open] .finding-toggle {
    transform: rotate(180deg);
    background: rgba(255, 255, 255, 0.6);
  }

  details[open] .finding-toggle::before {
    content: '−';
  }

  .finding-details {
    margin-top: 1.5rem;
    padding-left: 96px;
    display: grid;
    gap: 1.5rem;
  }

  .finding-media-grid {
    display: grid;
    grid-template-columns: 1.5fr 1fr; /* Adjusted for Left/Right split */
    gap: 1.5rem;
  }
  
  .finding-media-left-col {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  
  .finding-media-right-col {
    display: flex;
    align-items: center; /* Center vertically if needed */
  }

  .finding-media-grid-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .finding-media {
    width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 12px 28px rgba(15, 23, 42, 0.12);
    border: 1px solid #e2e8f0;
    background: #fff;
  }
  
  .media-lg {
    /* Optional: Ensure they take full width of column */
    width: 100%;
  }

  /* Table Styles for Finding 3 */
  .finding-table-wrapper {
    overflow-x: auto;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    background: white;
    margin-top: 1rem;
    max-width: 800px;
  }

  .finding-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }

  .finding-table th, .finding-table td {
    padding: 0.5rem;
    text-align: center;
    border: 1px solid #eee;
  }

  .table-header-main {
    background: #f0f4ff;
    color: #2a2f6c;
    font-weight: 700;
    padding: 0.6rem;
  }

  .header-sep {
    border-top: 2px solid #dde1e6;
  }

  .col-method {
    text-align: left;
    padding-left: 1rem;
    background: #f8f9fa;
    font-weight: 700;
  }

  .col-group {
    background: #fff;
    font-weight: 700;
    color: #444;
  }

  .col-sub {
    font-size: 0.8rem;
    color: #666;
    font-weight: 600;
  }

  .row-label {
    text-align: left;
    padding-left: 1rem;
    font-weight: 600;
    color: #333;
    background: #fcfcfc;
  }
  
  .best-score {
    font-weight: 700;
    background-color: rgba(100, 100, 100, 0.1);
  }

  @media (max-width: 768px) {
    .finding-media-grid {
        grid-template-columns: 1fr;
    }
  }

  details[open] .finding-header {
    margin-bottom: 0.5rem;
  }

  /* Finding 1 - Blue gradient */
  .finding-1 {
    color: #1976d2;
    background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
  }

  .finding-1:hover {
    background: linear-gradient(135deg, #ffffff 0%, #bbdefb 100%);
  }

  /* Finding 2 - Purple gradient */
  .finding-2 {
    color: #7b1fa2;
    background: linear-gradient(135deg, #ffffff 0%, #f3e5f5 100%);
  }

  .finding-2:hover {
    background: linear-gradient(135deg, #ffffff 0%, #e1bee7 100%);
  }

  /* Finding 3 - Orange gradient */
  .finding-3 {
    color: #f57c00;
    background: linear-gradient(135deg, #ffffff 0%, #fff3e0 100%);
  }

  .finding-3:hover {
    background: linear-gradient(135deg, #ffffff 0%, #ffe0b2 100%);
  }

  /* Finding 4 - Teal gradient */
  .finding-4 {
    color: #00796b;
    background: linear-gradient(135deg, #ffffff 0%, #e0f2f1 100%);
  }

  .finding-4:hover {
    background: linear-gradient(135deg, #ffffff 0%, #b2dfdb 100%);
  }

  @media (max-width: 768px) {
    .finding-card {
      padding: 1.5rem;
    }

    .finding-number {
      font-size: 2.5rem;
      min-width: auto;
    }

    .finding-title {
      font-size: 1.3rem;
    }

    .finding-header {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .finding-toggle {
      justify-self: flex-start;
    }

    .finding-details {
      padding-left: 0;
    }

    .finding-media-grid,
    .finding-media-grid-2 {
      grid-template-columns: 1fr;
    }

    .finding-text {
      font-size: 0.95rem;
    }
  }
</style>